<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Group Guard</title>
<style>
body{
  margin:0;
  font-family:Arial;
  color:#fff;
  background:linear-gradient(270deg,#0f2027,#203a43,#2c5364);
  background-size:600% 600%;
  animation:bg 15s ease infinite;
  text-align:center;
}
@keyframes bg{
  0%{background-position:0% 50%}
  50%{background-position:100% 50%}
  100%{background-position:0% 50%}
}
.card{
  margin-top:50px;
}
button{
  padding:12px 25px;
  margin:10px;
  border:none;
  border-radius:6px;
  font-size:16px;
}
input{
  padding:12px;
  width:220px;
}
.loader{
  border:4px solid #fff;
  border-top:4px solid transparent;
  border-radius:50%;
  width:30px;height:30px;
  animation:spin 1s linear infinite;
  margin:auto;
}
@keyframes spin{100%{transform:rotate(360deg)}}
</style>
</head>

<body>

<div class="card" id="home">
  <img src="pic.png" width="180"><br>
  <button onclick="showConnect()">Connect Number</button>
  <button onclick="showManage()">Manage Numbers</button>
</div>

<div class="card" id="connect" style="display:none;">
  <img src="pic.png" width="150"><br>
  <input id="num" placeholder="+923XXXXXXXXX"><br>
  <button onclick="pair()">Connect</button>
  <div id="status"></div>
</div>

<div class="card" id="manage" style="display:none;">
  <img src="pic.png" width="150"><br>
  <div id="list"></div>
</div>

<script>
const deviceId = localStorage.deviceId || 
  (localStorage.deviceId = crypto.randomUUID());

function showConnect(){
  home.style.display="none";
  connect.style.display="block";
}

function showManage(){
  home.style.display="none";
  manage.style.display="block";
  loadNumbers();
}

async function pair(){
  status.innerHTML='<div class="loader"></div>';
  const num = document.getElementById("num").value;
  const res = await fetch("/api/pair",{
    method:"POST",
    headers:{'Content-Type':'application/json'},
    body:JSON.stringify({deviceId, number:num})
  });
  const data = await res.json();
  status.innerHTML = `
    <p>Pairing Code:</p>
    <h2>${data.code}</h2>
    <button onclick="navigator.clipboard.writeText('${data.code}')">Copy</button>
  `;
}

async function loadNumbers(){
  const res = await fetch("/api/numbers/"+deviceId);
  const nums = await res.json();
  list.innerHTML = nums.map(n=>`<p>${n}</p>`).join("");
}
</script>

</body>
</html>